<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0"> 

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-137238428-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-137238428-1');

  // Needed for mobile <pre> tag sizes! - not anymore after specifying viewport properly!
  function getDefaultFontSize(){
   var who=document.createElement('div');
  
   who.style.cssText='white-space: pre-wrap !important; display:inline-block; padding:0; line-height:1; position:absolute; visibility:hidden; font-size:1em';
  
   who.appendChild(document.createTextNode('M'));
   document.body.appendChild(who);
   var fs= [who.offsetWidth, who.offsetHeight];
   document.body.removeChild(who);
   return fs;
  }

  function fixPreSize() {
    // Create our stylesheet to fix small letters for pre tags
    var style = document.createElement('style');
    style.innerHTML =
     'pre {' + // TODO: check what to do with [1]
      //'font-size:' + getDefaultFontSize()[0] + 'px' + 
      'font-size:200%' + 
     '}';
    
    // Get the first script tag
    var ref = document.querySelector('script');
    
    // Insert our new styles before the first script tag
    ref.parentNode.insertBefore(style, ref);
  }

  function myOnLoad() {
    //if( /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) ) {
      // If we are on a mobile phone
      //fixPreSize();
    //}
  }
</script>
<style>
body{font-family:Georgia,"Times New Roman",Times,serif;margin:0;padding:0;background-color:#F3F3F3;}
        #divbodyholder{padding:2%;background-color:#DDD;width:92%;margin:2% auto;}
        #divbody{border:solid 1px #ccc;background-color:#fff;padding:0% 5% 1% 5.2%;top:0;}
        .headerholder{background-color:#f9f9f9;border-top:solid 1px #ccc;border-left:solid 1px #ccc;border-right:solid 1px #ccc;}
        .header{width:95%;margin:0px auto;padding-top:24px;padding-bottom:8px;}
        .content{margin-bottom:45px;}
        .nomargin{margin:0;}
        .description{margin-top:10px;border-top:solid 1px #666;padding:10px 0;}
        h3{font-size:20pt;width:100%;font-weight:bold;margin-top:32px;margin-bottom:0;}
        .clear{clear:both;}
        #footer{padding-top:10px;border-top:solid 1px #666;color:#333333;text-align:center;font-size:small;font-family:"Courier New","Courier",monospace;}
        a{text-decoration:none;color:#003366 !important;}
        a:visited{text-decoration:none;color:#336699 !important;}
        blockquote{background-color:#f9f9f9;border-left:solid 4px #e9e9e9;margin-left:12px;padding:12px 12px 12px 24px;}
        blockquote img{margin:12px 0px;}
        blockquote iframe{margin:12px 0px;}
	#disqus-opener{cursor: pointer; width:100%}
}
</style>
<style>
#title{font-size: x-large;}
        a.ablack{color:black !important;}
        li{margin-bottom:8px;}
        ul,ol{margin-left:24px;margin-right:24px;}
        #all_posts{margin-top:24px;text-align:center;}
        .subtitle{font-size:small;margin:12px 0px;}
        .content p{margin-left:24px;margin-right:24px;text-align: justify;}
        h1{margin-bottom:12px !important;}
        #description{font-size:large;margin-bottom:12px;}
        h3{margin-top:42px;margin-bottom:8px;}
        h4{margin-left:24px;margin-right:24px;}
        #twitter{line-height:20px;vertical-align:top;text-align:right;font-style:italic;color:#333;margin-top:24px;font-size:small;}

	pre{
		overflow: auto;
		font-family: monospace;
		font-size: 1em;
	}

	code{
		color:#006400;
	}

	img {
		/* Centering
		display: block;
		margin-left: auto;
		margin-right: auto */

		/* Ensure width */
		max-width: 100%;
		/*max-height: 100%;*/
		height: auto;
	}
</style>
<title>Blog not mobile friendly? Neither apache mod_dir is!</title>
</head><body onload='myOnLoad()'>
<div id="divbodyholder">
<div class="headerholder"><div class="header">
<div id="title">
<h1 class="nomargin"><a class="ablack" href="http://ballmerpeak.web.elte.hu/devblog">Ballmerpeak devblog</a></h1>
<div id="description">Software development, related stuff and others</div>
</div></div></div>
<div id="divbody"><div class="content">
<!-- entry begin -->
<h3><a class="ablack" href="blog-not-mobile-friendly-neither-apache-moddir-is.html">
Blog not mobile friendly? Neither apache mod_dir is!
</a></h3>
<div class="subtitle">February 28, 2020  &mdash; 
Richárd Thier</div>
<!-- text begin -->

<p>As most of you already know, my blog is just static HTML but generated by one 
small bash script called bashblog or <code>bb.sh</code>. For this it is blazing fast and 
simple to load and pretty much always looked good on my phone too. When lookin 
at google search console I spot however that they said it is not really mobile 
friendly and you better take that seriously for SEO penalties and such.</p>

<p>Read on for some tips and tricks in responsive blog design.</p>

<h1>Always set meta viewport</h1>

<p>There is a single line of html practically all responsive designed pages add:</p>

<pre><code>    &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;
</code></pre>

<p>Interestingly this was missing from the bashblog template so I added it. To be 
honest bashblog lets you add a html header so it maybe does not count as a bug 
if you maybe do not want to be responsive.</p>

<p>This actually makes stuff better, but I also had to remove many pixel-sizes in 
bashblogs original stuff so now it is much better and more responsive. I think 
I do not need to write up what I changed in the original css for the bashblog 
as but <strong>scroll down to see my bb.sh fork</strong> (with other changes too) on github.</p>

<h1>Use internal CSS if you are on a slowly responding server</h1>

<p>After that change I did early, most of the problems were gone, but surprise is 
that I saw googlebot sometimes reporting this or that page to have the "text 
is too small to read" error and the "clickable links too close to each" error. 
The weird thing is that on every run they marked different pages with this!</p>

<p>This took me a looong time. Finally through fire an flames I have found that 
this is actually a double fault of googlebot and the servers that host my blog!</p>

<p>I have found out (by running lighthouse myself for example) that my pages are 
actually well and count as mobile friendly. What causes the issue then? The 
server and its surroundings! This was revelation. I am not running this server 
as the caesar servers I use while writing this post is a free service for the 
current and former ELTE university students and I still host some of my things 
here because of why not. But when doing a so called "valósidejű elemzés" or as 
I translate the googlebot words "realtime test" on the search console it turns 
out many of the "resources" are having errors and are not loaded by the bot. </p>

<p>These resource errors are mostly images, but holy heavens! The CSS file itself 
is not loaded! This is actually really bad as the blog was not mobile friendly 
without its CSS so surely this is a problem.</p>

<p>As I did not want to change the place I serve this blog from, I thought I can 
maybe try to <strong>change bashblog to write CSS files internally into HTML</strong>. This 
change was easy to make and I added <code>css_is_internal=true</code> where you can tell 
if you want bashblog to internalize (copy its content into HTML) your CSS or 
you want its original solution to just refer to them as external files.</p>

<p>Rem.: As I wrote about it earlier in <a href="http://ballmerpeak.web.elte.hu/devblog/website-and-blog-speedup-tricks.html">Blog speedup tricks</a> here, I actually 
use lazy loading of CSS for stuff that I am not using - like CSS of asciinema.
That is necessary if you want to use internal CSS in HTML otherwise it just 
grows big anyways and will be slow anyways: speed will be bad, not your stats 
on the mobile friendliness rating.</p>

<h1>The apache mod_dir is not responsive</h1>

<p>After all this I still got that my blog is not mobile friendly according to 
googlebot in the search console. The issue is once again the small text and 
small clickable areas, but it showed my attachments folder. Oh... so there is 
this <code>mod_dir</code> enabled on apache and I actually use it and googlebot found it!</p>

<p>It basically gives you a directory listing whene there is no index.html. Some 
would say immediately that this is a security issue anyways, but my blog was 
just static html pages with no server-side code whatsoever so what wrong could 
happen anyways by someone seeing static html files?</p>

<p>You can turn this feature off by writing this to the topmost <code>.htaccess</code>:</p>

<pre><code>    Options -Indexes
</code></pre>

<p>That is fine and first I thought I am not even using this feature anyways, but 
I grepped and searched around a bit and found several use cases for it on my 
blog and pages. I was thinking maybe there is a way to add CSS to it and asked 
around a bit, but no one seemed to know a way for it and maybe there is none.</p>

<h1>Generating "mod_dir"-like index.html</h1>

<p>Actually I then went that way that I go with disabled mod_dir and generate a 
similar index.html myself if something similar is needed. It seems like that 
is the most easy solution to make the issue go away keep references to the 
directory listings in my few posts and other few places.</p>

<p>I have found two easy ways to generate such a html:</p>

<ol>
<li>Re-enable mod_dir and wget its result down from the directory it is needed</li>
<li>Use <code>tree -H .</code> to generate html output (this generates multiple levels)</li>
</ol>

<p>After these, you can add a simple style sheet to your html or maybe even do 
some kind of automation to magically add those styles by some script.</p>

<p>I took the first way, but it is good to know that tree command has html output.</p>

<p>Ading only these few lines in the beginning of <code>&lt;head&gt;</code> would suffixe:</p>

<pre><code>    &lt;meta charset="UTF-8"&gt;
    &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt; 
    &lt;style&gt;
    body {
      font-size: 2.5vw;
    }
    a { 
      font-size: 2.5vw;
    }
    td {
      font-size: 2.5vw;
    }
    &lt;/style&gt;
</code></pre>

<p>After adding these the page seems to be nice and mobile friendly with the 
<a href="https://search.google.com/test/mobile-friendly">google mobile friendliness tester</a>.</p>

<p><strong>I think developers at apache mod_dir maybe should add this!</strong></p>

<p>Maybe I can just do a pull request to their project if I find where and how 
these index files got generated. I think it is some simple code anyways. I 
guess the easiest way to find where to change the code would be to grep their 
codebase for the word <code>Indexes</code> and go from there to the generation code.</p>

<h1>Final words, my bashblog fork</h1>

<p>After all the above now the blog should be once again mobile friendly. Also it 
should be like that according to googlebot which is nice for SEO. I already do 
lose some traffic likely because this server seems to not use SSL at all. That 
is actually not really an issue for my static blog, but heuristics do not know 
that my blog is static and thus SEO could suffer. There might be other stuff 
why it might suffer but first things first ;-)</p>

<p><a href="https://github.com/prenex/devblog">The fork of bashblog can be downloaded from my github</a>. It also contains 
this whole blog as an example code for its usage and you can even read it on 
github, my gitea or wherever if you want to! It also serves as backup...</p>

<p>Tags: <a href='tag_responsive.html'>responsive</a>, <a href='tag_web.html'>web</a>, <a href='tag_blog.html'>blog</a>, <a href='tag_development.html'>development</a>, <a href='tag_trickz.html'>trickz</a>, <a href='tag_tutorial.html'>tutorial</a>, <a href='tag_apache.html'>apache</a>, <a href='tag_mod_dir.html'>mod_dir</a>, <a href='tag_text-is-too-small-to-read.html'>text-is-too-small-to-read</a>, <a href='tag_googlebot.html'>googlebot</a>, <a href='tag_internal.html'>internal</a>, <a href='tag_css.html'>css</a></p>

<!-- text end -->
<!-- entry end -->
</div>
<div id="disqus_thread"></div>
            <img id="disqus-opener" src="discus-logo.jpg">
            <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
               var disqus_shortname = 'ballmerpeak-devblog'; // required: replace example with your forum shortname

            /* * * DONT EDIT BELOW THIS LINE * * */
            var embedfun_disqus = (function() {
            var dsq = document.createElement("script"); dsq.type = "text/javascript"; dsq.async = true;
            dsq.src = "//" + disqus_shortname + ".disqus.com/embed.js";
            (document.getElementsByTagName("head")[0] || document.getElementsByTagName("body")[0]).appendChild(dsq);
            });
            </script>
            <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
            <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
<div id="footer">CC by-nc-nd <a href="https://disqus.com/by/prenex/">Richárd Thier</a> &mdash; <a href="mailto:u9vata&#64;gmail&#46;com">u9vata&#64;gmail&#46;com</a><br/>
Generated with <a href="https://github.com/cfenollosa/bashblog">bashblog</a>, a single bash script to easily create blogs like this one</div>
</div></div>
<script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'ballmerpeak-devblog'; // required: replace example with your forum shortname

        /* * * DONT EDIT BELOW THIS LINE * * */
        var countfun_disqus = (function () {
        var s = document.createElement("script"); s.async = true;
        s.type = "text/javascript";
        s.src = "//" + disqus_shortname + ".disqus.com/count.js";
        (document.getElementsByTagName("HEAD")[0] || document.getElementsByTagName("BODY")[0]).appendChild(s);
        })
        // This is a custom hackz of mine!!!
        // We only let disqus work if the user really wants it!!!
        // onload is needed as otherwise opener will be null below,
        // we can wait until window load, but need to preserve any earlier!
        var prev_handler = window.onload;
        window.onload = function () {
          if (prev_handler) {
            prev_handler();
          }
          var opener = document.getElementById("disqus-opener");
          opener.onclick = function() {
              opener.onclick = null;
              opener.parentNode.removeChild(opener);
              embedfun_disqus();
              countfun_disqus();
          };
        };
    </script>
</body></html>
